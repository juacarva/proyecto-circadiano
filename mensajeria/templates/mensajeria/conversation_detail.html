{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
    {% if is_new_conversation %}
        Iniciar Conversación con {{ other_participant.username }}
    {% elif other_participant %}
        Conversación con {{ other_participant.username }}
    {% else %}
        Conversación #{{ conversation.id }}
    {% endif %} - Blog Circadiano
{% endblock %}

{% block content %}
<div class="conversation-header">
    <h1>
        {% if is_new_conversation %}
            Iniciar nueva conversación con {{ other_participant.username }}
        {% elif other_participant %}
            Conversación con {{ other_participant.username }}
        {% else %}
            Detalle de Conversación #{{ conversation.id }}
        {% endif %}
    </h1>
    <a href="{% url 'mensajeria:inbox' %}" class="back-to-inbox-link">Volver a la Bandeja de Entrada</a>
</div>

<div class="message-list-container">
    {% if messages %}
        {% for message in messages %}
            <div class="message-item {% if message.sender == user %}sent{% else %}received{% endif %}">
                <div class="message-bubble">
                    <div class="message-meta">
                        <span class="sender-username">{{ message.sender.username }}</span>
                        <span class="timestamp">{{ message.timestamp|date:"d M Y H:i" }}</span>
                        {% if message.sender == user %}
                            <span class="read-status {% if not message.is_read %}unread{% endif %}">
                                {{ message.is_read|yesno:"Leído,No leído" }}
                            </span>
                        {% endif %}
                    </div>
                    <div class="message-content">{{ message.content|linebreaksbr }}</div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="no-conversations">
            {% if is_new_conversation %}
                Envía tu primer mensaje para iniciar la conversación con {{ other_participant.username }}.
            {% else %}
                No hay mensajes en esta conversación todavía.
            {% endif %}
        </p>
    {% endif %}
</div>

<div class="message-form-container">
    <h3>Enviar Mensaje</h3>
    <form method="post" action=".">
        {% csrf_token %}
        <div class="form-group">
            <label for="{{ form.content.id_for_label }}">Contenido del Mensaje:</label>
            {% render_field form.content class="form-input" placeholder="Escribe tu mensaje..." %}
        </div>
        <button type="submit" class="send-message-btn">Enviar Mensaje</button>
    </form>
</div>
{% endblock %}