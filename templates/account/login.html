{% extends "base.html" %}
{% load i18n %}
{% load socialaccount %} {# Añadimos esto para el botón social #}
{% load allauth %}
{% load widget_tweaks %}

{% block title %}Iniciar Sesión{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Iniciar Sesión</h2>

    {# --- SECCIÓN DE LOGIN SOCIAL MEJORADA (la misma que en signup.html) --- #}
    {% get_providers as socialaccount_providers %}
    {% if socialaccount_providers %}
        <div class="social-login-section">
            {% for provider in socialaccount_providers %}
                {% if provider.id == 'google' %}
                    <a href="{% provider_login_url 'google' process='login' %}" class="social-login-btn google">
                        <i class="fa-brands fa-google"></i> Inicia Sesión con Google
                    </a>
                {% endif %}
            {% endfor %}
        </div>
        <div class="login-or"><span>o, si estas registrado</span></div>
    {% endif %}
    {# --- FIN DE LA SECCIÓN MEJORADA --- #}

    <form class="login" method="post" action="{% url 'account_login' %}">
        {% csrf_token %}

        <div class="form-group">
            <label for="{{ form.login.id_for_label }}">Email</label>
            {% render_field form.login class="form-input" placeholder="tu@email.com" %}
            {% for error in form.login.errors %}
                <p class="errorlist">{{ error }}</p>
            {% endfor %}
        </div>

        <div class="form-group">
            <label for="{{ form.password.id_for_label }}">Contraseña</label>
            {% render_field form.password class="form-input" placeholder="Contraseña" %}
            {% for error in form.password.errors %}
                <p class="errorlist">{{ error }}</p>
            {% endfor %}
        </div>
        
        {% if form.non_field_errors %}
            {% for error in form.non_field_errors %}
                <p class="errorlist">{{ error }}</p>
            {% endfor %}
        {% endif %}

        {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
        {% endif %}
        
        <button type="submit" class="submit-button">Iniciar Sesión</button>
    </form>
    
    <div style="margin-top: 20px;">
        <a href="{% url 'account_reset_password' %}">¿Olvidaste tu contraseña?</a>
        <p style="margin-top: 20px;">¿No tienes una cuenta? <a href="{% url 'account_signup' %}">Regístrate aquí</a></p>
    </div>
</div>
{% endblock %}